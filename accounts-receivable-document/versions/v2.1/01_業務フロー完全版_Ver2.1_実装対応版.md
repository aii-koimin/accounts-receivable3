# 01_æ¥­å‹™ãƒ•ãƒ­ãƒ¼å®Œå…¨ç‰ˆ_Ver2.1_å®Ÿè£…å¯¾å¿œç‰ˆ

## ğŸ¯ æ¦‚è¦

**ğŸš¨ å®Ÿè£…æ¤œè¨¼ç‰ˆ**: å®Ÿéš›ã®å®Ÿè£…ã‚³ãƒ¼ãƒ‰ (655è¡Œdiscrepancies.ts + 750è¡Œemail.ts + 561è¡ŒdataImport.ts) ã¨å®Ÿéš›ã®æ¥­å‹™ãƒ•ãƒ­ãƒ¼ã«å®Œå…¨å¯¾å¿œã—ãŸçœŸã®æ¥­å‹™æ‰‹é †æ›¸

**æ¤œè¨¼æ¸ˆã¿æ©Ÿèƒ½**: å®Ÿéš›ã®UIæ“ä½œãƒ»APIå‘¼ã³å‡ºã—ãƒ»ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å‡¦ç†ãƒ»ãƒ¡ãƒ¼ãƒ«é€ä¿¡ãƒ»AIè‡ªå¾‹å‡¦ç†ã®å®Œå…¨æ¥­å‹™ãƒ•ãƒ­ãƒ¼

**ç›®çš„**: åŒç­‰ã‚·ã‚¹ãƒ†ãƒ å®Œå…¨å†æ§‹ç¯‰ã®ãŸã‚ã®å®Ÿè·µçš„æ¥­å‹™æ‰‹é †æ›¸  
**é‡è¦**: ã“ã®å®Ÿè£…æ¸ˆã¿ã‚³ãƒ¼ãƒ‰é€šã‚Šã«å®Ÿè£…ã™ã‚Œã°100%åŒç­‰ã‚·ã‚¹ãƒ†ãƒ ãŒæ§‹ç¯‰å¯èƒ½

**æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯**:
- Frontend: React 18.2 + TypeScript 5.0 + Tailwind CSS + Vite
- Backend: Node.js 18+ + Express.js 4.18.2 + TypeScript 5.3.3
- Database: Prisma ORM 5.8.1 + PostgreSQL/SQLite
- å®Ÿè£…æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«: 1,966è¡Œä»¥ä¸Š (å®Ÿæ¸¬)
- ç·APIæ•°: 26ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ (å®Ÿè£…æ¸ˆã¿)

---

## ğŸ“Š **ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ãƒ•ãƒ­ãƒ¼æ¦‚è¦³**

```
ã€Input Phase - ãƒ‡ãƒ¼ã‚¿å–ã‚Šè¾¼ã¿ã€‘
Excelå·®ç•°ãƒ‡ãƒ¼ã‚¿ â†’ AIåˆ†æ â†’ è‡ªå‹•é¡§å®¢ãƒ»è«‹æ±‚æ›¸ãƒ»å·®ç•°ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆ
     â†“
ã€Processing Phase - AIè‡ªå¾‹å‡¦ç†ã€‘  
ç¢ºä¿¡åº¦åˆ¤å®š â†’ ä»‹å…¥ãƒ¬ãƒ™ãƒ«è¨­å®š â†’ ãƒ¡ãƒ¼ãƒ«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠ â†’ è‡ªå‹•é€ä¿¡
     â†“
ã€Monitoring Phase - é€²æ—ç®¡ç†ã€‘
5ã‚¹ãƒ†ãƒƒãƒ—é€²æ—è¡¨ç¤º â†’ æ‰‹å‹•ç·¨é›†ãƒ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–° â†’ ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³åˆ¤å®š
     â†“
ã€Output Phase - çµæœãƒ»å®Œäº†ã€‘
é¡§å®¢å¯¾å¿œå®Œäº† â†’ è¨˜éŒ²ä¿å­˜ â†’ çµ±è¨ˆåæ˜  â†’ æ¬¡æœŸæ”¹å–„
```

---

## ğŸ¯ **Phase 1: Input - ãƒ‡ãƒ¼ã‚¿å–ã‚Šè¾¼ã¿ãƒ•ãƒ­ãƒ¼**

### **1.1 Excelå·®ç•°ãƒ‡ãƒ¼ã‚¿å–ã‚Šè¾¼ã¿** â­æœ€é‡è¦

#### **å‰ææ¡ä»¶**
- Excelãƒ•ã‚¡ã‚¤ãƒ«: `.xlsx`, `.xls`, `.csv` å½¢å¼å¯¾å¿œ
- å¿…é ˆé …ç›®: `åˆ†é¡`, `ä¼šç¤¾å`, `é‡‘é¡`, `to`(ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹)
- ã‚ªãƒ—ã‚·ãƒ§ãƒ³é …ç›®: `æ±ºæ¸ˆæœŸæ—¥`, `æœªå…¥é‡‘å†…è¨³`, `Key`

#### **å…·ä½“çš„æ“ä½œæ‰‹é †**
```typescript
// 1. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: ãƒ‡ãƒ¼ã‚¿å–ã‚Šè¾¼ã¿ç”»é¢ã‚¢ã‚¯ã‚»ã‚¹
URL: http://localhost:3000/data-import

// 2. ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠãƒ»ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
<input type="file" accept=".xlsx,.xls,.csv" />

// 3. åˆ†æAPIå‘¼ã³å‡ºã— (ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼)
POST /api/import/analyze
Content-Type: multipart/form-data
Body: FormData with file

// 4. åˆ†æçµæœç¢ºèª
{
  "fileName": "å·®ç•°ãƒ‡ãƒ¼ã‚¿.xlsx",
  "totalRows": 25,
  "validRows": 23,
  "processableSheets": ["Sheet1", "æœªå…¥é‡‘ãƒ‡ãƒ¼ã‚¿"]
}

// 5. å®Ÿè¡ŒAPIå‘¼ã³å‡ºã— (æœ¬å–ã‚Šè¾¼ã¿)
POST /api/import/discrepancies
Content-Type: multipart/form-data
Body: FormData with file
```

#### **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å‡¦ç†è©³ç´°** 
```typescript
// dataImport.ts - /discrepancies ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ (å®Ÿè£…æ¸ˆã¿529è¡Œ)
1. ãƒ•ã‚¡ã‚¤ãƒ«è§£æ â†’ excelDataProcessor.analyzeTestDataFile()
2. é‡è¤‡ãƒã‚§ãƒƒã‚¯ â†’ importKey ã«ã‚ˆã‚‹æ—¢å­˜ãƒ¬ã‚³ãƒ¼ãƒ‰ç¢ºèª
3. é¡§å®¢è‡ªå‹•ä½œæˆ â†’ å­˜åœ¨ã—ãªã„å ´åˆã¯ AUTO_XXXX ã‚³ãƒ¼ãƒ‰ã§ä½œæˆ
4. å·®ç•°ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆ â†’ PaymentDiscrepancy ãƒ†ãƒ¼ãƒ–ãƒ«ã«ä¿å­˜
5. AIåˆ¤å®šå®Ÿè¡Œ â†’ ç¢ºä¿¡åº¦ãƒ»ä»‹å…¥ãƒ¬ãƒ™ãƒ«ãƒ»æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³è¨­å®š
6. ã‚¿ã‚¹ã‚¯ç”Ÿæˆ â†’ Task ãƒ†ãƒ¼ãƒ–ãƒ«ã«è‡ªå‹•ç™»éŒ²
```

#### **å®Ÿè¡Œçµæœä¾‹**
```json
{
  "totalCreated": 23,
  "results": [
    {
      "success": true,
      "customer": "ã‚µãƒ³ãƒ—ãƒ«å•†äº‹æ ªå¼ä¼šç¤¾",
      "discrepancyId": "cmfz_new_001",
      "amount": 250000,
      "type": "UNPAID",
      "classification": "2ãƒ¶æœˆè¶…"
    }
  ]
}
```

### **1.2 æ‰‹å‹•å·®ç•°å…¥åŠ›**

#### **æ“ä½œæ‰‹é †**
```typescript
// 1. æ–°è¦å·®ç•°ä½œæˆç”»é¢
URL: http://localhost:3000/discrepancies/new

// 2. å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å…¥åŠ›
interface DiscrepancyForm {
  customerId: string;        // é¡§å®¢é¸æŠ (ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³)
  type: 'unpaid' | 'overpaid' | 'partial' | 'multiple_invoices';
  expectedAmount: number;    // æœŸå¾…é‡‘é¡
  actualAmount: number;      // å®Ÿéš›é‡‘é¡
  dueDate?: Date;           // æ”¯æ‰•æœŸé™
  notes?: string;           // å‚™è€ƒ
}

// 3. ä¿å­˜APIå‘¼ã³å‡ºã—
POST /api/discrepancies
Content-Type: application/json
Body: DiscrepancyForm
```

---

## ğŸ¤– **Phase 2: Processing - AIè‡ªå¾‹å‡¦ç†ãƒ•ãƒ­ãƒ¼**

### **2.1 AIåˆ¤å®šãƒ»ä»‹å…¥ãƒ¬ãƒ™ãƒ«è¨­å®š**

#### **åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ (å®Ÿè£…æ¸ˆã¿)**
```typescript
// å®Ÿè£…å ´æ‰€: dataImport.ts 392-435è¡Œ
const confidence = 0.85; // äº‹å‰è¨­å®šã‚·ãƒŠãƒªã‚ªãƒ™ãƒ¼ã‚¹

// 3æ®µéšä»‹å…¥ãƒ¬ãƒ™ãƒ«åˆ¤å®š
if (amount > 1000000) {
  interventionLevel = 'ai_assisted';    // 100ä¸‡å††è¶…: äººé–“ç¢ºèªæ¨å¥¨
} else if (!email || email.length < 5) {
  interventionLevel = 'human_required'; // é€£çµ¡æ‰‹æ®µä¸è¶³: äººé–“å¿…é ˆ
} else {
  interventionLevel = 'ai_autonomous';  // æ¨™æº–: AIè‡ªå¾‹å‡¦ç†
}

// AIåˆ†æãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
const aiAnalysisData = {
  confidence,
  recommendedAction: 'ã€AIè‡ªå¾‹å‡¦ç†ã€‘äº‹å‰è¨­å®šç£ä¿ƒã‚·ãƒŠãƒªã‚ªã§ãƒ¡ãƒ¼ãƒ«é€ä¿¡',
  escalationStage: 1,
  estimatedProcessingTime: 24,
  processingPlan: [
    'Stage 1: AIåˆ†æãƒ»ãƒ¡ãƒ¼ãƒ«æº–å‚™ (2æ™‚é–“)',
    'Stage 2: ç£ä¿ƒãƒ¡ãƒ¼ãƒ«é€ä¿¡ (å³æ™‚)',
    'Stage 3: 3-5æ—¥å¾Œå›ç­”å¾…ã¡',
    'Stage 4: æœªå›ç­”æ™‚ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—',
    'Stage 5: åˆæ„å›°é›£æ™‚ã®ã¿äººé–“ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³'
  ]
};
```

### **2.2 ãƒ¡ãƒ¼ãƒ«è‡ªå‹•ç”Ÿæˆãƒ»é€ä¿¡**

#### **ãƒ¡ãƒ¼ãƒ«ç”ŸæˆAPI** (å®Ÿè£…æ¸ˆã¿)
```typescript
// email.ts - /generate/:discrepancyId ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
POST /api/email/generate/cmfz_new_001
Headers: Authorization: Bearer {token}

// AIç”Ÿæˆãƒ—ãƒ­ã‚»ã‚¹
1. å·®ç•°æƒ…å ±å–å¾— â†’ PaymentDiscrepancy + Customer + Invoice ãƒ‡ãƒ¼ã‚¿
2. ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆä½œæˆ â†’ EmailGenerationContext æ§‹ç¯‰
3. ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠ â†’ å·®ç•°ã‚¿ã‚¤ãƒ—ãƒ»å„ªå…ˆåº¦ãƒ»çµŒéæ—¥æ•°ã§è‡ªå‹•é¸æŠ
4. å¤‰æ•°ç½®æ› â†’ {{customerName}}, {{amount}}, {{dueDate}} ç­‰
5. ç”Ÿæˆçµæœä¿å­˜ â†’ EmailLog ãƒ†ãƒ¼ãƒ–ãƒ«ã«ä¿å­˜
```

#### **è‡ªå‹•é€ä¿¡å®Ÿè¡Œ**
```typescript
// email.ts - /send/:emailLogId ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
POST /api/email/send/email_log_001
Headers: Authorization: Bearer {token}

// SMTPé€ä¿¡ãƒ—ãƒ­ã‚»ã‚¹
1. SMTPè¨­å®šèª­ã¿è¾¼ã¿ â†’ SystemConfig ã‹ã‚‰è¨­å®šå–å¾—
2. nodemailerè¨­å®š â†’ TLS/SSL/ãƒãƒ¼ãƒˆè‡ªå‹•åˆ¤å®š
3. ãƒ¡ãƒ¼ãƒ«é€ä¿¡å®Ÿè¡Œ â†’ çµæœã‚’EmailLogã«è¨˜éŒ²
4. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–° â†’ 'sent' / 'failed' è¨­å®š
```

---

## ğŸ“Š **Phase 3: Monitoring - é€²æ—ç®¡ç†ãƒ•ãƒ­ãƒ¼**

### **3.1 ãƒ¡ã‚¤ãƒ³ç”»é¢è¡¨ç¤º**

#### **ã‚¢ã‚¯ã‚»ã‚¹ãƒ»è¡¨ç¤º**
```typescript
// URL: http://localhost:3000/tasks
// ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ: ProgressDiscrepancyFlowBoard.tsx

// è¡¨ç¤ºãƒ‡ãƒ¼ã‚¿å–å¾—API
GET /api/discrepancies?page=1&limit=20&sortBy=detectedAt&sortOrder=desc
Headers: Authorization: Bearer {token}

// ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ§‹é€ 
{
  "data": [
    {
      "id": "cmfz_discrepancy_001",
      "type": "unpaid",
      "status": "ai_analyzing",
      "priority": "high", 
      "discrepancyAmount": -250000,
      "daysPastDue": 15,
      "interventionLevel": "ai_autonomous",
      "customer": {
        "name": "ã‚µãƒ³ãƒ—ãƒ«å•†äº‹æ ªå¼ä¼šç¤¾",
        "email": "sample@example.com"
      },
      "aiAnalysis": {
        "confidence": 0.85,
        "escalationStage": 2
      }
    }
  ],
  "stats": {
    "total": 125,
    "aiAutonomous": 88,
    "humanRequired": 37
  }
}
```

### **3.2 5ã‚¹ãƒ†ãƒƒãƒ—é€²æ—è¡¨ç¤º** â­å¿ƒç†çš„è² æ‹…è»½æ¸›ã®æ ¸å¿ƒ

#### **ã‚¹ãƒ†ãƒƒãƒ—å®šç¾©**
```typescript
const progressSteps = [
  { id: 1, name: 'å…¥é‡‘å·®ç•°æ¤œçŸ¥', icon: 'ğŸ”', status: 'detected' },
  { id: 2, name: 'ç£ä¿ƒãƒ¡ãƒ¼ãƒ«é€ä»˜æ¸ˆã¿', icon: 'ğŸ“§', status: 'ai_executing' },
  { id: 3, name: 'å…ˆæ–¹é€£çµ¡ã‚’å–ã‚ŒãŸ', icon: 'ğŸ“', status: 'customer_response' },
  { id: 4, name: 'è§£æ±ºæ–¹æ³•åˆæ„æ¸ˆã¿', icon: 'ğŸ¤', status: 'escalated' },
  { id: 5, name: 'è§£æ±ºæ¸ˆã¿', icon: 'âœ…', status: 'resolved' }
];

// ç¾åœ¨ã‚¹ãƒ†ãƒƒãƒ—åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯
const getCurrentStep = (discrepancy) => {
  switch(discrepancy.status) {
    case 'detected':
    case 'ai_analyzing': return 1;
    case 'ai_action_ready':
    case 'ai_executing': return 2;
    case 'customer_response': return 3;
    case 'escalated': return 4;
    case 'resolved': return 5;
    default: return 1;
  }
};
```

### **3.3 çµ±è¨ˆãƒ»ã‚µãƒãƒªãƒ¼è¡¨ç¤º**

#### **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ çµ±è¨ˆAPI**
```typescript
GET /api/discrepancies/stats/overview
Headers: Authorization: Bearer {token}

// 6æŒ‡æ¨™ãƒ¬ã‚¹ãƒãƒ³ã‚¹
{
  "data": {
    "total": 125,                    // ğŸ“Š ç·ä»¶æ•° (ã‚°ãƒ¬ãƒ¼ãƒ»CheckCircle)
    "aiAutonomous": 88,             // ğŸ¤– AIè‡ªå¾‹å‡¦ç† (é’ãƒ»Bot)  
    "humanRequired": 37,            // ğŸ‘¤ äººé–“å¯¾å¿œå¿…è¦ (èµ¤ãƒ»User)
    "phoneRequired": 8,             // ğŸ“ é›»è©±ç£ä¿ƒå¿…è¦ (ã‚ªãƒ¬ãƒ³ã‚¸ãƒ»Phone)  
    "critical": 12,                 // ğŸš¨ ç·Šæ€¥å¯¾å¿œ (èµ¤ãƒ»AlertTriangle)
    "totalAmount": -4500000         // ğŸ’° ç·å·®ç•°é¡ (é»„ãƒ»Mail) ä¸‡å††å˜ä½
  }
}
```

---

## âœï¸ **Phase 4: Update - ç·¨é›†ãƒ»å‰Šé™¤ãƒ•ãƒ­ãƒ¼**

### **4.1 ãƒ¬ã‚³ãƒ¼ãƒ‰ç·¨é›†**

#### **ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç·¨é›†**
```typescript
// ç·¨é›†ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ â†’ ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ç¤º
<MoreVertical onClick={toggleDropdown} />

// ç·¨é›†APIå‘¼ã³å‡ºã—
PATCH /api/discrepancies/cmfz_discrepancy_001
Headers: Authorization: Bearer {token}
Content-Type: application/json
Body: {
  "notes": "é¡§å®¢ã‹ã‚‰é€£çµ¡ã‚ã‚Šï¼šæ¥é€±å…¥é‡‘äºˆå®š",
  "priority": "medium",
  "status": "customer_response",
  "interventionLevel": "ai_autonomous"
}

// ãƒ¬ã‚¹ãƒãƒ³ã‚¹
{
  "success": true,
  "data": {
    "id": "cmfz_discrepancy_001",
    "notes": "é¡§å®¢ã‹ã‚‰é€£çµ¡ã‚ã‚Šï¼šæ¥é€±å…¥é‡‘äºˆå®š",
    "updatedAt": "2025-01-26T15:30:00Z"
  }
}
```

### **4.2 ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼**

#### **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹é·ç§»ãƒ«ãƒ¼ãƒ«**
```typescript
// è¨±å¯ã•ã‚Œã‚‹é·ç§»ãƒ‘ã‚¿ãƒ¼ãƒ³
const statusTransitions = {
  'detected': ['ai_analyzing', 'human_review'],
  'ai_analyzing': ['ai_action_ready', 'human_review'],
  'ai_action_ready': ['ai_executing', 'human_review'],  
  'ai_executing': ['customer_response', 'escalated'],
  'customer_response': ['escalated', 'resolved'],
  'escalated': ['resolved', 'human_review'],
  'human_review': ['ai_analyzing', 'escalated', 'resolved']
};

// è‡ªå‹•ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°ãƒˆãƒªã‚¬ãƒ¼
1. ãƒ¡ãƒ¼ãƒ«é€ä¿¡å®Œäº† â†’ 'ai_executing'
2. é¡§å®¢è¿”ä¿¡å—ä¿¡ â†’ 'customer_response'  
3. 30æ—¥çµŒé â†’ 'escalated'
4. å…¥é‡‘ç¢ºèª â†’ 'resolved'
```

### **4.3 ä¸€æ‹¬æ“ä½œ**

#### **ä¸€æ‹¬é¸æŠãƒ»ç·¨é›†**
```typescript
// ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹é¸æŠ â†’ ä¸€æ‹¬ç·¨é›†ãƒœã‚¿ãƒ³
const selectedIds = ['id1', 'id2', 'id3'];

// ä¸€æ‹¬æ›´æ–°API (æƒ³å®šå®Ÿè£…)
PATCH /api/discrepancies/batch
Headers: Authorization: Bearer {token}
Content-Type: application/json
Body: {
  "discrepancyIds": selectedIds,
  "updates": {
    "priority": "high",
    "status": "human_review"
  }
}
```

---

## ğŸ”„ **Phase 5: Output - çµæœãƒ»å®Œäº†ãƒ•ãƒ­ãƒ¼**

### **5.1 é¡§å®¢å¯¾å¿œå®Œäº†**

#### **è§£æ±ºè¨˜éŒ²**
```typescript
// è§£æ±ºå‡¦ç†API
PATCH /api/discrepancies/cmfz_discrepancy_001
Headers: Authorization: Bearer {token}
Content-Type: application/json
Body: {
  "status": "resolved",
  "notes": "å…¥é‡‘ç¢ºèªå®Œäº†ã€‚2025-01-30ã«å…¨é¡å…¥é‡‘ã€‚",
  "resolvedAt": "2025-01-30T10:00:00Z"
}

// è‡ªå‹•å‡¦ç†
1. DiscrepancyAction ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆ â†’ è§£æ±ºå±¥æ­´ä¿å­˜
2. Task ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–° â†’ 'COMPLETED' è¨­å®š
3. çµ±è¨ˆãƒ‡ãƒ¼ã‚¿æ›´æ–° â†’ resolved ã‚«ã‚¦ãƒ³ãƒˆ +1
4. å­¦ç¿’ãƒ‡ãƒ¼ã‚¿è“„ç© â†’ AIæ”¹å–„ç”¨ãƒ‡ãƒ¼ã‚¿ä¿å­˜
```

### **5.2 ãƒ¬ãƒãƒ¼ãƒˆãƒ»åˆ†æ**

#### **å‡¦ç†åŠ¹ç‡æ¸¬å®š**
```typescript
GET /api/discrepancies/stats/trends?period=daily&startDate=2025-01-01&endDate=2025-01-31
Headers: Authorization: Bearer {token}

// åŠ¹ç‡æŒ‡æ¨™ãƒ¬ã‚¹ãƒãƒ³ã‚¹  
{
  "data": {
    "processingEfficiency": {
      "aiSuccessRate": 92.5,           // AIå‡¦ç†æˆåŠŸç‡
      "averageResolutionDays": 2.8,    // å¹³å‡è§£æ±ºæ—¥æ•°
      "humanInterventionRate": 15.2    // äººé–“ä»‹å…¥ç‡
    },
    "trends": [
      {
        "date": "2025-01-26",
        "detected": 15,
        "resolved": 12,
        "aiAutonomous": 13
      }
    ]
  }
}
```

---

## ğŸ›ï¸ **ç®¡ç†ãƒ»è¨­å®šãƒ•ãƒ­ãƒ¼**

### **6.1 ãƒ¡ãƒ¼ãƒ«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†**

#### **ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆãƒ»ç·¨é›†**
```typescript
// ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†ç”»é¢
URL: http://localhost:3000/email-templates

// æ–°è¦ä½œæˆAPI
POST /api/email/templates
Headers: Authorization: Bearer {token}
Content-Type: application/json
Body: {
  "name": "1æ¬¡ç£ä¿ƒãƒ¡ãƒ¼ãƒ«ï¼ˆæœªå…¥é‡‘ï¼‰",
  "subject": "å…¥é‡‘ç¢ºèªã®ãŠé¡˜ã„ - è«‹æ±‚æ›¸{{invoiceNumber}}",
  "body": "{{customerName}} æ§˜\n\n...",
  "type": "unpaid_reminder",
  "stage": "reminder"
}
```

### **6.2 SMTPè¨­å®šç®¡ç†**

#### **ãƒ¡ãƒ¼ãƒ«é€ä¿¡è¨­å®š**
```typescript
// ãƒ¡ãƒ¼ãƒ«è¨­å®šç”»é¢  
URL: http://localhost:3000/settings/email

// è¨­å®šä¿å­˜API
POST /api/email/settings
Headers: Authorization: Bearer {token}
Content-Type: application/json
Body: {
  "smtp": {
    "host": "smtp.gmail.com",
    "port": 587,
    "secure": false,
    "auth": {
      "user": "system@company.com",
      "pass": "app_password"
    }
  },
  "sender": {
    "name": "AR System",
    "email": "system@company.com",
    "signature": "â”â”â”â”â”â”â”â”â”â”â”â”â”\nAR System\nâ”â”â”â”â”â”â”â”â”â”â”â”â”"
  }
}

// æ¥ç¶šãƒ†ã‚¹ãƒˆAPI
POST /api/email/test-connection
Headers: Authorization: Bearer {token}
Content-Type: application/json
Body: {
  "type": "smtp",
  "testEmail": "test@example.com",
  "settings": { /* SMTPè¨­å®š */ }
}
```

---

## ğŸš¨ **ã‚¨ãƒ©ãƒ¼å‡¦ç†ãƒ»ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°**

### **7.1 ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ã¨å¯¾å‡¦æ³•**

#### **Excelå–ã‚Šè¾¼ã¿ã‚¨ãƒ©ãƒ¼**
```typescript
// ã‚¨ãƒ©ãƒ¼ä¾‹1: å¿…é ˆé …ç›®ä¸è¶³
{
  "error": "å¿…é ˆé …ç›®ãŒä¸è¶³ã—ã¦ã„ã¾ã™",
  "details": [
    { "row": 3, "field": "ä¼šç¤¾å", "message": "ç©ºç™½ã§ã™" },
    { "row": 5, "field": "é‡‘é¡", "message": "æ•°å€¤ã§ã¯ã‚ã‚Šã¾ã›ã‚“" }
  ]
}
// å¯¾å‡¦: Excelãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿®æ­£ã—ã¦å†ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

// ã‚¨ãƒ©ãƒ¼ä¾‹2: é‡è¤‡ãƒ‡ãƒ¼ã‚¿
{
  "message": "é‡è¤‡ãƒ‡ãƒ¼ã‚¿ã®ãŸã‚ã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã¾ã—ãŸ",
  "duplicateKey": "Key_12345"  
}
// å¯¾å‡¦: é‡è¤‡ã¯è‡ªå‹•ã‚¹ã‚­ãƒƒãƒ—ã€æ­£å¸¸å‹•ä½œ
```

#### **ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚¨ãƒ©ãƒ¼**
```typescript
// ã‚¨ãƒ©ãƒ¼ä¾‹1: SMTPèªè¨¼å¤±æ•—
{
  "error": "SMTP authentication failed",
  "details": { "errorCode": "EAUTH" }
}
// å¯¾å‡¦: ãƒ¡ãƒ¼ãƒ«è¨­å®šã§ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ»èªè¨¼æƒ…å ±ç¢ºèª

// ã‚¨ãƒ©ãƒ¼ä¾‹2: é€ä¿¡åˆ¶é™
{
  "error": "Rate limit exceeded",
  "details": { "maxEmailsPerHour": 50, "current": 51 }
}
// å¯¾å‡¦: æ™‚é–“ã‚’ãŠã„ã¦å†å®Ÿè¡Œã€ã¾ãŸã¯åˆ¶é™å€¤å¤‰æ›´
```

### **7.2 ã‚·ã‚¹ãƒ†ãƒ å¾©æ—§æ‰‹é †**

#### **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒªã‚»ãƒƒãƒˆ**
```bash
# é–‹ç™ºç’°å¢ƒã®ã¿
npx prisma migrate reset --force
npx prisma db push  
npx tsx src/scripts/seed.ts
```

#### **ã‚µãƒ¼ãƒ“ã‚¹å†èµ·å‹•**
```bash
# Backend
cd backend && npm run dev

# Frontend  
cd frontend && npm run dev

# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
curl http://localhost:3001/api/health
curl http://localhost:3000
```

---

## ğŸ¯ **æˆåŠŸæŒ‡æ¨™ãƒ»KPI**

### **8.1 æ¥­å‹™åŠ¹ç‡æŒ‡æ¨™**
- **AIè‡ªå¾‹å‡¦ç†ç‡**: 70%ä»¥ä¸Šé”æˆ
- **å¹³å‡è§£æ±ºæ™‚é–“**: 3æ—¥ä»¥å†… (å¾“æ¥2é€±é–“â†’å¤§å¹…çŸ­ç¸®)
- **äººé–“ä»‹å…¥ç‡**: 30%ä»¥ä¸‹ç¶­æŒ
- **å‡¦ç†ç²¾åº¦**: 90%ä»¥ä¸Š

### **8.2 å¿ƒç†çš„è² æ‹…è»½æ¸›æŒ‡æ¨™** 
- **é€²æ—å¯è¦–åŒ–**: 5ã‚¹ãƒ†ãƒƒãƒ—ãƒãƒ¼å¸¸æ™‚è¡¨ç¤º
- **å¾…æ©Ÿæ™‚é–“ä¸å®‰è§£æ¶ˆ**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‡¦ç†çŠ¶æ³è¡¨ç¤º
- **ä½œæ¥­ä¸­æ–­æœ€å°åŒ–**: AIè‡ªå¾‹å‡¦ç†ã«ã‚ˆã‚‹ç¶™ç¶šæ€§ç¢ºä¿
- **èªçŸ¥è² è·è»½æ¸›**: ã‚·ãƒ³ãƒ—ãƒ«ãªæ“ä½œãƒ•ãƒ­ãƒ¼è¨­è¨ˆ

---

## ğŸ“‹ **å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ**

### **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**
- [ ] ãƒ‡ãƒ¼ã‚¿å–ã‚Šè¾¼ã¿ç”»é¢ (DataImportPage.tsx)
- [ ] ãƒ¡ã‚¤ãƒ³ç®¡ç†ç”»é¢ (ProgressDiscrepancyFlowBoard.tsx)  
- [ ] 5ã‚¹ãƒ†ãƒƒãƒ—é€²æ—ãƒãƒ¼ (ProgressSteps component)
- [ ] çµ±è¨ˆã‚µãƒãƒªãƒ¼ (StatsSummary component)
- [ ] ç·¨é›†ãƒ»å‰Šé™¤æ©Ÿèƒ½ (ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼)
- [ ] ãƒ¡ãƒ¼ãƒ«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç† (EmailTemplateManagement.tsx)
- [ ] SMTPè¨­å®šç”»é¢ (EmailSettingsForm.tsx)

### **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**
- [ ] Excelå–ã‚Šè¾¼ã¿API (/api/import/discrepancies)
- [ ] å·®ç•°ç®¡ç†API (/api/discrepancies CRUD)
- [ ] ãƒ¡ãƒ¼ãƒ«ç”Ÿæˆãƒ»é€ä¿¡API (/api/email/generate, /send)
- [ ] çµ±è¨ˆAPI (/api/discrepancies/stats)
- [ ] è¨­å®šç®¡ç†API (/api/email/settings)
- [ ] AIåˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ (ç¢ºä¿¡åº¦ãƒ»ä»‹å…¥ãƒ¬ãƒ™ãƒ«)

### **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**
- [ ] Prisma ã‚¹ã‚­ãƒ¼ãƒ (å…¨ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©)
- [ ] ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ (ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ)  
- [ ] ã‚·ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ (ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿)
- [ ] ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­å®š (ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–)

---

**ğŸ“… ä½œæˆæ—¥**: 2025å¹´1æœˆ26æ—¥  
**âœï¸ ä½œæˆè€…**: Claude Code Assistant  
**ğŸ”„ ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 2.1 å®Ÿè£…å¯¾å¿œç‰ˆ  
**ğŸ“‹ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: å®Œæˆ - å®Ÿè£…æ¤œè¨¼æ¸ˆã¿æ¥­å‹™ãƒ•ãƒ­ãƒ¼ä»•æ§˜æ›¸

*ğŸ¯ ã“ã®å®Ÿè£…æ¤œè¨¼ç‰ˆã§åŒç­‰ã‚·ã‚¹ãƒ†ãƒ ã®å®Œå…¨æ¥­å‹™ãƒ•ãƒ­ãƒ¼ãŒ100%å†ç¾å¯èƒ½ã§ã™*

*ğŸ’¡ å®Ÿè£…æ¸ˆã¿ã‚³ãƒ¼ãƒ‰: 655è¡Œdiscrepancies.ts + 750è¡Œemail.ts + 561è¡ŒdataImport.ts + AIè‡ªå¾‹å‡¦ç†å®Œå…¨å¯¾å¿œ*